<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="guofangchao,疯狂紫萧" />










<meta name="description" content="疯狂紫萧,郭方超">
<meta property="og:type" content="website">
<meta property="og:title" content="IT技术博客">
<meta property="og:url" content="http://www.guofangchao.com/index.html">
<meta property="og:site_name" content="IT技术博客">
<meta property="og:description" content="疯狂紫萧,郭方超">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="IT技术博客">
<meta name="twitter:description" content="疯狂紫萧,郭方超">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.guofangchao.com/"/>





  <title>IT技术博客</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?643d73884f29a250f12d991eaf23e1d7";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">IT技术博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">一个技术人的实验室</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.guofangchao.com/2018/03/14/04-基础-组件和商品详情/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="疯狂紫萧">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IT技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/14/04-基础-组件和商品详情/" itemprop="url">04.基础-组件和商品详情</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-14T22:40:00+08:00">
                2018-03-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/big-front-end/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/03/14/04-基础-组件和商品详情/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2018/03/14/04-基础-组件和商品详情/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>知识点：<br>1.使用路由跳转内页<br>2.开发完整的商品详情页<br>3.弹出选择数量</p>
</blockquote>
<p>前面的代码已经加入git仓库，<a href="https://gitee.com/cuo9958/react-native-demo" target="_blank" rel="noopener">链接地址</a>。讲项目放在本地的同学也可以试着将代码放到仓库里。这个地方可以使用单独的分支合并到master，也可以直接覆盖带master分支。</p>
<p>为了能够更直观的看到每次提交的代码，我尽量把每一节的内容都做一次提交，备注也会写的非常清楚.另外我也会不定时的增加各种注释到代码里。一般情况只需要切换到不同的提交时间点即可看到当时使用的代码了。</p>
<h2 id="添加页面和跳转"><a href="#添加页面和跳转" class="headerlink" title="添加页面和跳转"></a>添加页面和跳转</h2><p>在src目录下添加一个新的目录detail，用来放新加入的详情页。新建goods.js，并写几行简单的代码。<br><img src="http://images.gitbook.cn/903f2990-1a04-11e8-9971-a10b6269e5d3" alt="enter image description here"></p>
<p>在src下的index.js中，将新建的页面加入到路由里。<br><img src="http://images.gitbook.cn/f32cf000-1a04-11e8-9971-a10b6269e5d3" alt="enter image description here"></p>
<p>这样新建的详情页就加入了路由管理，只要在需要跳转的时候执行传入路由的名字就可以了。这里改造home页，将几个地方的跳转改成刚才的路由名称就可以了。<br><img src="http://images.gitbook.cn/87c455f0-1a05-11e8-9971-a10b6269e5d3" alt="enter image description here"></p>
<p>点击商品就会发现已经可以跳转到详情页了，但是现在详情页什么都没有。同时也不能返回到上一页。<br><img src="http://images.gitbook.cn/c5ff9460-1a05-11e8-9971-a10b6269e5d3" alt="enter image description here"></p>
<h2 id="自定义顶部"><a href="#自定义顶部" class="headerlink" title="自定义顶部"></a>自定义顶部</h2><p>在src下新建一个component目录，用来存放头部组件以及以后会用到的一些其他组件。将组件抽成一个公用的组件是一个非常明智的方法，它会让你省下很多的时间。最好的做法就是做一个兼容很多情况的组件，然后使用继承的方法做一些参数的重载。<br><img src="http://images.gitbook.cn/94ed4b80-1a08-11e8-9971-a10b6269e5d3" alt="enter image description here"></p>
<p>改造这个组件，让ios的顶部和安卓的顶部高度一致，把ios顶部的系统组件露出来。默认情况下ios顶部在小图标下面，安卓则有一个系统的顶部横条，小图标不影响正常的界面。<br><img src="http://images.gitbook.cn/83bb85a0-1a0a-11e8-9971-a10b6269e5d3" alt="enter image description here"></p>
<p>顶部组件默认有一个中间的标题，下面再加一个默认的左侧返回键。返回键使用的是路由组件的gobanck方法。右侧给一个自定义右侧按钮的方法。<br><img src="http://images.gitbook.cn/f5a49800-1a0a-11e8-9971-a10b6269e5d3" alt="enter image description here"></p>
<p>把这个自定义组件放在详情页，然后给一个title值。一个简单的顶部组件就做完了。<br><img src="http://images.gitbook.cn/259fc430-1a0b-11e8-9971-a10b6269e5d3" alt="enter image description here"></p>
<p>刷新页面看效果，点击一下返回键，看看是不是可以用了。<br><img src="http://images.gitbook.cn/47c14110-1a0b-11e8-9971-a10b6269e5d3" alt="enter image description here"></p>
<h2 id="详情页顶部"><a href="#详情页顶部" class="headerlink" title="详情页顶部"></a>详情页顶部</h2><p>上半部分包括头图和几个属性介绍。</p>
<p>详情页的所有内容使用ScrollView包裹。这是一个比较简单的列表组件，使用非常方便。在列表不长的情况下请尽量使用这个组件。<br><img src="http://images.gitbook.cn/3c8a3e30-1a0d-11e8-9971-a10b6269e5d3" alt="enter image description here"></p>
<p>将路由传进来的参数保存在组件的变量里。由于传入的参数有2个，所有这个地方使用了2个变量，同时后面做判断的时候也要判断2次。<br><img src="http://images.gitbook.cn/210266f0-1a0e-11e8-9971-a10b6269e5d3" alt="enter image description here"></p>
<p>在组件初始化之后调用接口，将接口返回的数据存入组件的state中。这里注意把state中的变量提前写好，减少不必要的bug。<br><img src="http://images.gitbook.cn/7f7c8a20-1a0f-11e8-9971-a10b6269e5d3" alt="enter image description here"></p>
<p>在最上面添加一个商品图片，然后接着添加价格等信息。<br><img src="http://images.gitbook.cn/e9e83450-1a13-11e8-9971-a10b6269e5d3" alt="enter image description here"><br><img src="http://images.gitbook.cn/bc02efd0-1a13-11e8-9971-a10b6269e5d3" alt="enter image description here"></p>
<p>到这里，详情页的简单信息就实现了。后面再添加一个详细的商品信息就可以了。<br><img src="http://images.gitbook.cn/ec14bf00-1a18-11e8-9971-a10b6269e5d3" alt="enter image description here"></p>
<p>这里需要注意的是,接口返回的图片有大有小，这里做了一个处理,图片太大的话就缩小一些。<br><img src="http://images.gitbook.cn/19060690-1a19-11e8-9971-a10b6269e5d3" alt="enter image description here"></p>
<p>最终效果和正常的电商APP就很相似了。如果有特殊的样式还可以再自己调整。<br><img src="http://images.gitbook.cn/4d48a070-1a19-11e8-9971-a10b6269e5d3" alt="enter image description here"></p>
<p>上面的开发完成之后图片是同时加载的，导致有时候上部分的图片显示延迟，后面优化的时候会优化这种情况。</p>
<h2 id="购买和加入购物车"><a href="#购买和加入购物车" class="headerlink" title="购买和加入购物车"></a>购买和加入购物车</h2><p>展示的界面有了，下面再加上加入购物车、购买等按钮就可以了。</p>
<p>按钮要求悬浮在界面的最下方，所以要将这几个按钮放在ScrollView的后面。放在里面虽然也可以做到，但是非常不推荐，这样会增加渲染难度。<br><img src="http://images.gitbook.cn/34b81df0-1a1f-11e8-9971-a10b6269e5d3" alt="enter image description here"></p>
<p>这里有3个按钮，分别是购物车、立即购买和分享商品。<br><img src="http://images.gitbook.cn/ba8e33b0-1a1f-11e8-9971-a10b6269e5d3" alt="enter image description here"></p>
<h2 id="购买弹出层"><a href="#购买弹出层" class="headerlink" title="购买弹出层"></a>购买弹出层</h2><p>点击立即购买按钮不会直接跳转到下单页，这里会弹出一个简单的选择数量的页面。在RN中如果需要使用这样的一个层就需要用Modal组件来做。Modal在RN中是一个单独的view层，默认覆盖在所有的页面上面。<br><img src="http://images.gitbook.cn/4859df20-1a2d-11e8-9971-a10b6269e5d3" alt="enter image description here"></p>
<p>这里设置Modal不使用默认的动画、全完透明，给onRequestClose添加一个默认的方法，不然会在手机上报错。</p>
<p>首先给Modal加一个内容层。这一层的主要作用是自己做遮罩的样式。这里是一个半透明的黑色遮罩。内部加一层点击区域，效果等于再点击黑色透明层的时候能够关掉弹出层。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> &lt;View style=&#123;SpecificationsStyle.warp&#125;&gt;</span><br><span class="line">      &lt;TouchableOpacity </span><br><span class="line">      activeOpacity=&#123;<span class="number">0.9</span>&#125;</span><br><span class="line">      style=&#123;&#123; <span class="attr">width</span>: px(<span class="number">750</span>), <span class="attr">flex</span>: <span class="number">1</span> &#125;&#125; </span><br><span class="line">      onPress=&#123;() =&gt; <span class="keyword">this</span>.setState(&#123; <span class="attr">priceBoxStatus</span>: <span class="literal">false</span> &#125;)&#125;&gt;&lt;/TouchableOpacity&gt;</span><br><span class="line">&lt;<span class="regexp">/View&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>接下来开始写商品简略信息，包括商品小图、价格。<br><img src="http://images.gitbook.cn/f016c6d0-1a3a-11e8-9971-a10b6269e5d3" alt="enter image description here"></p>
<p>下面再加一层用来放选择商品数量和购买按钮。<br><img src="http://images.gitbook.cn/4549d7a0-1a3b-11e8-9971-a10b6269e5d3" alt="enter image description here"></p>
<p>最后把几个事件实现一下。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//购买方法</span></span><br><span class="line">   openbuy() &#123;</span><br><span class="line">       <span class="keyword">this</span>.setState(&#123; <span class="attr">priceBoxStatus</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//数量减少</span></span><br><span class="line">   reduce() &#123;</span><br><span class="line">       <span class="keyword">if</span> (<span class="keyword">this</span>.state.buyNumber == <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">       <span class="keyword">let</span> buyNumber = <span class="built_in">Number</span>(<span class="keyword">this</span>.state.buyNumber) || <span class="number">2</span>;</span><br><span class="line">       <span class="keyword">if</span> (<span class="built_in">isNaN</span>(buyNumber)) buyNumber = <span class="number">2</span>;</span><br><span class="line">       <span class="keyword">this</span>.setState(&#123; <span class="attr">buyNumber</span>: --buyNumber &#125;)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//改数量</span></span><br><span class="line">   changeNumber(num) &#123;</span><br><span class="line">       num = <span class="built_in">Number</span>(num);</span><br><span class="line">       <span class="keyword">if</span> (<span class="built_in">isNaN</span>(num)) num = <span class="number">1</span>;</span><br><span class="line">       <span class="keyword">if</span> (num &gt; <span class="keyword">this</span>.state.limitStock) &#123;</span><br><span class="line">           num = <span class="number">1</span></span><br><span class="line">           toast(<span class="string">`库存不足`</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">           buyNumber: num</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//增加数量</span></span><br><span class="line">   plus() &#123;</span><br><span class="line">       <span class="keyword">if</span> (<span class="keyword">this</span>.state.isBuyLimit == <span class="number">1</span> &amp;&amp; <span class="keyword">this</span>.state.buyNumber &gt;= <span class="keyword">this</span>.state.buyLimitNum) &#123;</span><br><span class="line">           toast(<span class="string">`该商品为限购商品,<span class="subst">$&#123;<span class="keyword">this</span>.state.buyLimitMsg&#125;</span>`</span>);</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (<span class="keyword">this</span>.state.buyNumber &gt;= <span class="keyword">this</span>.state.limitStock) &#123;</span><br><span class="line">           toast(<span class="string">`库存仅剩<span class="subst">$&#123;<span class="keyword">this</span>.state.limitStock&#125;</span>件`</span>);</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">let</span> qty = <span class="keyword">this</span>.state.buyNumber || <span class="number">1</span>;</span><br><span class="line">       <span class="keyword">if</span> (<span class="built_in">isNaN</span>(qty)) qty = <span class="number">1</span>;</span><br><span class="line">       <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">           buyNumber: ++qty</span><br><span class="line">       &#125;)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>最终效果如图。点击立即购买按钮即可弹出这一个弹出层。弹出层可以选择数量，默认保持数量为1，受库存以及最大可选择的数量影响。也可以直接点击按钮跳转到购买页。<br><img src="http://images.gitbook.cn/bf604470-1a3b-11e8-9971-a10b6269e5d3" alt="enter image description here"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.guofangchao.com/2018/03/14/03-基础-首页模板和商品列表/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="疯狂紫萧">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IT技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/14/03-基础-首页模板和商品列表/" itemprop="url">03.基础-首页模板和商品列表</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-14T22:39:00+08:00">
                2018-03-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/big-front-end/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/03/14/03-基础-首页模板和商品列表/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2018/03/14/03-基础-首页模板和商品列表/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>知识点：<br>1.给首页添加banner<br>2.给首页添加运营模板<br>3.获取接口的商品<br>4.给顶部加一个搜索条</p>
</blockquote>
<p>从这章开始我们正式开始案例的开发。git仓库的地址会放到下一章显示，需要的同学可以直接去git上看每一次提交的代码。</p>
<p>本文先从最早的代码形式开始一步一步的讲下去，开始开发的app会在某些情况下很卡，后面会将优化需要做的东西讲出来。这里先从简单的实现app界面开始讲，如果你觉得手机反应慢，请看后面的优化部分。</p>
<h2 id="首页容器"><a href="#首页容器" class="headerlink" title="首页容器"></a>首页容器</h2><p>修改首页index.js文件,创建一个容器,用来放置后面要添加的各种组件。<br><img src="http://images.gitbook.cn/f4e4f830-18af-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<h2 id="Banner和快捷入口"><a href="#Banner和快捷入口" class="headerlink" title="Banner和快捷入口"></a>Banner和快捷入口</h2><p>这里的Banner用到了一个轮播图组件。根目录下执行<code>npm i --save react-native-swiper</code>安装新的组件。</p>
<p>创建一个组件，这个组件用来放Banner和快捷入口。<br><img src="http://images.gitbook.cn/bc64f0d0-18b1-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>这里创建state中变量，banners用来存储banner列表，quicks用来存储快捷入口的列表。</p>
<p>请求远程接口，将返回的数据放入state中。<br><img src="http://images.gitbook.cn/bf88b420-18b3-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>将banner渲染再页面上。这里有一个小技巧，如果只有一张图片就不再使用轮播图。<br><img src="http://images.gitbook.cn/b27a69b0-1938-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>接下来就是快捷入口，由于快捷入口用到了gif图。所以这里添加一个第三方的组件<code>react-native-fast-image</code>。在线的项目使用的是官方推荐的设置方法，让RN的image组件支持的gif。</p>
<p>执行<code>npm i --save react-native-fast-image</code>，然后使用link命令将组件加入到原生代码里。<code>react-native link react-native-fast-image</code>，执行完毕重新运行模拟器<code>react-native run-ios</code>。<br><img src="http://images.gitbook.cn/14fef190-193a-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>将state中的数据渲染在banner的下面。这里用到了几个组件和一个新的图片，需要单独添加。ImageBackground是RN在0.47之后的版本加入的组件，它可以将一个图片当做背景来使用。这里推荐在0.50之后的版本中使用。<br><img src="http://images.gitbook.cn/f39655b0-193f-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>刷新模拟器看看效果。一个简单的banner+入口的界面就显示出来了。是不是非常简单！<br><img src="http://images.gitbook.cn/9969cfd0-1940-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<h2 id="自定义模板"><a href="#自定义模板" class="headerlink" title="自定义模板"></a>自定义模板</h2><p>从入口下面开始就是一个自定义的模板。这里使用现成的接口，现成的设计来做模板。运营人员会在后端传入图片并设置跳转链接。app根据设计好的样式渲染模板结果。目前有8个模板在使用，后面可能会添加更多。这里先不管后面的新模板。</p>
<p>在home下新建一个<code>floor_modules.js</code>文件。自定义模板单独放在这里处理。这里由于代码比较长就不贴出来了，有想看具体情况的可以去git仓库看。<br><img src="http://images.gitbook.cn/a53303c0-1942-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p><img src="http://images.gitbook.cn/c8d9e820-1942-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p> 到目前为止使用还是View组件。这个组件是不支持滑动的，要想列表可以滑动，需要将渲染结果放在专门的列表组件中才行。这里不适用ScrollView的原因是，FlatList可以在滚动的时候隐藏屏幕外的无用节点。可以提高列表性能，尤其是列表非常长的时候。<br><img src="http://images.gitbook.cn/e9656640-1943-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>把刚才写的2个组件放到Flatlist中的header组件中<code>ListHeaderComponent</code>。</p>
<ul>
<li>使用numColumns设置列表为双列。</li>
<li>使用refreshing传入下拉刷新使用到的变量。</li>
<li>使用onRefresh在下拉刷新的时候重新获取列表数据</li>
<li>使用onEndReached在滑动到列表底部的时候加载下一页</li>
<li>使用ListHeaderComponent渲染列表的头</li>
<li>使用renderItem渲染列表项。</li>
<li>使用ListFooterComponent设置底部的文字，一般可以给加载下一页展示加载的状态、文字。</li>
<li>使用onScroll在滑动的时候触发自己的事件。这里使用scrollEventThrottle控制触发的频率，内部的数字就是1000毫秒内触发的次数，数字越大触发越少。</li>
<li>使用keyExtractor设置列表每个项的key。在列表判断列表项的时候会使用这个返回的id作为key。注意，这里返回的值不能重复。</li>
<li>使用data设置商品的项，必须是数组。</li>
</ul>
<h2 id="商品列表"><a href="#商品列表" class="headerlink" title="商品列表"></a>商品列表</h2><p>首先给上面的2个组件添加一个名字，然后在刷新方法里调用他们的刷新方法。这样就可以做到在下拉刷新的时候同时可以刷新前面2个组件。<br><img src="http://images.gitbook.cn/ee2d3210-1944-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>添加一个请求数据的方法并在组件初始化结束之后调用方法。这里使用await来达到同步等待请求结果的效果。注意，必须使用try来包裹这个方法。否则在返回错误信息的时候会发生app奔溃的效果。<br><img src="http://images.gitbook.cn/d29bb680-1948-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>这里设置了一个start变量来存储页码。这里注意一下，只有需要改变UI的变量才需要放到state里面，其他的尽量放到组件自身上面或者其他地方。否在在改变一些无意义的数据的时候也会触发界面刷新。</p>
<p><img src="http://images.gitbook.cn/224e6470-1949-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>这里把加载下一页单独写成一个方法了。有的手机在初始化列表的时候不仅会调用一次获取第一页的方法，同时也会调用一次下一页的方法。</p>
<p>新建商品列表组件GoodItem，修改Flatlist组件，把GoodItem放到内容渲染方法里。<br><img src="http://images.gitbook.cn/91048660-1949-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>这里将数组序号也传入组件，目的是给商品列表的每一项添加一个不一样的样式。这里设置的样式在安卓和ios上会有不同的效果<br><img src="http://images.gitbook.cn/c301c420-1949-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>通过取余方法即可完成每行有2中不同的样式。这在双列的列表中非常的常用。<br><img src="http://images.gitbook.cn/fccbecd0-1949-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<hr>
<p>首页列表中的这个大块头部组件和列表中的非常多得商品项会暴露出很多问题。后面会把这一块优化，以达到和原生一样的效果。</p>
<h2 id="头部组件"><a href="#头部组件" class="headerlink" title="头部组件"></a>头部组件</h2><p>初步开发已经完成了。但是我们还需要在这个的基础上再加上头部组件，这个组件负责显示用的一些信息和一个假的搜索条。这样才是一个完整的APP该有的样子。</p>
<p>添加一个SearchHeader组件，用来做商品列表页的顶部。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//顶部搜索条组件</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SearchHeader</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    render()&#123;</span><br><span class="line">	    <span class="comment">//这里先不去管具体的内容</span></span><br><span class="line">        <span class="keyword">return</span> &lt;View&gt;&lt;/View&gt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>将组件放在最外层，同时使用绝对定位将顶部浮动在所有组件的最前面。这里先不讲动画，看着难受的同学可以先把浮动的组件改成普通的组件。<br><img src="http://images.gitbook.cn/80e0ea40-194d-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> styles = StyleSheet.create(&#123;</span><br><span class="line">    headerView: &#123;</span><br><span class="line">        position: <span class="string">"absolute"</span>,</span><br><span class="line">        left: <span class="number">0</span>,</span><br><span class="line">        right: <span class="number">0</span>,</span><br><span class="line">        top: <span class="number">0</span>,</span><br><span class="line">        zIndex: <span class="number">100</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    pageView: &#123;</span><br><span class="line">        flex: <span class="number">1</span>,</span><br><span class="line">        width: deviceWidth,</span><br><span class="line">    &#125;,</span><br><span class="line">    loading: &#123;</span><br><span class="line">        textAlign: <span class="string">'center'</span>,</span><br><span class="line">        fontSize: px(<span class="number">28</span>),</span><br><span class="line">        color: <span class="string">"#ccc"</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>顶部添加一个头像显示组件，中间添加一个输入框。这里的输入框没有实际的功能，主要是为了跳转到真正的搜索页的。<br><img src="http://images.gitbook.cn/0c6a0ba0-194e-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>到这里基本就开发完了。将它们组合在一起然后刷新页面。<br><img src="http://images.gitbook.cn/50a934d0-194e-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<h2 id="完成"><a href="#完成" class="headerlink" title="完成"></a>完成</h2><p>到这里就完成了基础的首页开发。一个简单的首页就呈现在外面的面前。如果懂打包的同学已经可以马上打一个apk文件了。这里稍微注意一下，模拟器使用的是ios，打包最方便的还是安卓，但是ios和安卓在某些情况下会有一些区别。比如样式上会根据手机的不同有一些不一样的效果，有些组件甚至只支持ios。</p>
<p>在浏览的时候也会看到滑动会有一些生涩，点击跳转也没有做。顶部最好有一些动画等等。这些在后面都会有涉及。<br><img src="http://images.gitbook.cn/94028eb0-194a-11e8-8087-9b6b3b447adf" alt="enter image description here"><br>图中就是在说列表太长导致更新很慢，同时还提醒开发者使用PureComponent来优化性能。后面会教大家怎样使用purComponent和shouldComponentUpdate来优化性能。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.guofangchao.com/2018/03/14/02-基础-封装自己的库/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="疯狂紫萧">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IT技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/14/02-基础-封装自己的库/" itemprop="url">02.基础-封装自己的库</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-14T22:38:00+08:00">
                2018-03-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/big-front-end/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/03/14/02-基础-封装自己的库/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2018/03/14/02-基础-封装自己的库/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>知识点：<br>1.封装一个自己的日志，代替原生的console<br>2.封装一个自己的请求库，代替原生的fetch<br>3.自适应方法，兼容各种手机屏幕<br>4.封装一个本地存储<br>5.集成toast弹出提示<br>6.让iOS支持http地址<br>7.安卓需要证书才能编译</p>
</blockquote>
<p>在正式开始之前，我们先封装几个要用到的库。</p>
<h2 id="自定义本地日志"><a href="#自定义本地日志" class="headerlink" title="自定义本地日志"></a>自定义本地日志</h2><p>自定义日志的一个好处就是省的每次都要手动注释console。而且还可以同时将日志存在本地，或者发到日志服务器。一个方法就一举多得了。</p>
<p>在src目录下新建一个utils文件夹。我们封装一个日志输出类。开发模式下使用<code>console.log</code>命令。正式情况下记录在变量中，方便在手机上查看日志。</p>
<p>新建一个log.js文件。路径为<code>根目录/src/utils/log.js</code>。<br><img src="http://images.gitbook.cn/80223590-1886-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>新建一个数组变量<code>logs</code>，用来临时存放日志信息。<br><img src="http://images.gitbook.cn/98604390-1886-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>将日志分成信息、警告和错误3种，分别给出3个可调用的方法。同时给第一个参数加一个好看的颜色。<br><img src="http://images.gitbook.cn/cc840ad0-1886-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>在index中引入日志组件，写几个方法看看调用的结果。<br><img src="http://images.gitbook.cn/1100b230-1887-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>这里稍微定义一下日志的要求。参数0，字符串。参数1，对象。参数2，字符串。<br><img src="http://images.gitbook.cn/25fcb490-1887-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<h2 id="自定义请求"><a href="#自定义请求" class="headerlink" title="自定义请求"></a>自定义请求</h2><p>RN默认提供了fetch方法去请求远程数据。我们再封装一次，将这个方法将会针对现有的项目做封装，在使用请求的时候能够更适合、更方便。这里使用header保存了一些临时的变量，算是一个小小的全局缓存吧。</p>
<p>创建request.js文件，目录：<code>根目录/src/utils/request.js</code>。<br><img src="http://images.gitbook.cn/80223590-1886-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>将请求header里的信息单独出来，每次请求都需要带上这个共享header数据。<br><img src="http://images.gitbook.cn/29975590-1889-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>创建一个Request类,并将这个类对外公开。这里讲请求初始化一次，以后用到别的请求的时候也可以单独实例化一次。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 请求库</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Request();</span><br></pre></td></tr></table></figure></p>
<p>每次请求都将header中的内容带入请求中，单独检测httpcode和后端返回的code值。这里可以直接做权限检测，在需要的时候跳转到登录页。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 请求库</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 检测返回状态码</span></span><br><span class="line"><span class="comment">    * @param &#123;*&#125; status </span></span><br><span class="line"><span class="comment">    * @param &#123;*&#125; res </span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">async</span> _checkStatus(status, res, url) &#123;</span><br><span class="line">        <span class="keyword">if</span> (status !== <span class="number">200</span>) &#123;</span><br><span class="line">            logWarm(<span class="string">'请求失败参数'</span>, <span class="keyword">await</span> res.text(), url, headers);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'网络连接失败，请检查网络'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 检查后端返回的状态码</span></span><br><span class="line"><span class="comment">    * @param &#123;*&#125; status </span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    _checkAppStatus(json, url) &#123;</span><br><span class="line">        <span class="keyword">if</span> (json.status != <span class="number">0</span>) &#123;</span><br><span class="line">            logWarm(<span class="string">'返回状态报错'</span>, json, url);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`<span class="subst">$&#123;json.errorMsg&#125;</span>`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 内部实现网络请求</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; url </span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; options </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> _request(url, options, type) &#123;</span><br><span class="line">        url = url.indexOf(<span class="string">'http'</span>) == <span class="number">0</span> ? url : url.indexOf(<span class="string">'/api'</span>) == <span class="number">0</span> ? domain + url : baseUrl + url;</span><br><span class="line">        <span class="keyword">let</span> res = <span class="keyword">await</span> fetch(url, options);</span><br><span class="line">        <span class="keyword">this</span>._checkStatus(res.status, res, url)</span><br><span class="line">        <span class="keyword">if</span> (type === <span class="string">'json'</span>) <span class="keyword">return</span> <span class="keyword">await</span> <span class="keyword">this</span>._jsonFactory(res, url, options)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> <span class="keyword">this</span>._jsonFactory(res, url, options)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 处理json数据</span></span><br><span class="line"><span class="comment">         * @param &#123;*&#125; res </span></span><br><span class="line"><span class="comment">         * @param &#123;*&#125; url </span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    <span class="keyword">async</span> _jsonFactory(res, url, options) &#123;</span><br><span class="line">        <span class="keyword">let</span> json;</span><br><span class="line">        <span class="keyword">let</span> txt = <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            txt = <span class="keyword">await</span> res.text();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            log(<span class="string">'未拿到返回字符串'</span>, &#123; <span class="attr">url</span>: url, <span class="attr">txt</span>: txt &#125;);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'数据格式错误'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            json = <span class="built_in">JSON</span>.parse(txt);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            logErr(<span class="string">'返回数据格式错误'</span>, &#123; <span class="attr">url</span>: url, <span class="attr">txt</span>: txt &#125;);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'数据格式错误'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>._checkAppStatus(json, url)</span><br><span class="line">        log(<span class="string">"请求返回"</span>, json, url, options);</span><br><span class="line">        <span class="keyword">return</span> json.data;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get请求</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; url </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> get(url, data) &#123;</span><br><span class="line">        <span class="keyword">if</span> (data) data = urlEncoded(data);</span><br><span class="line">        <span class="keyword">if</span> (url.indexOf(<span class="string">'?'</span>) &lt; <span class="number">0</span> &amp;&amp; data) url += <span class="string">'?'</span> + data;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._request(url, &#123;</span><br><span class="line">            method: <span class="string">'GET'</span>,</span><br><span class="line">            headers: headers,</span><br><span class="line">            timeout: <span class="number">10000</span></span><br><span class="line">        &#125;, <span class="string">'json'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * post请求</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; url </span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; data </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> post(url, data) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._request(url, &#123;</span><br><span class="line">            method: <span class="string">'POST'</span>,</span><br><span class="line">            headers: <span class="built_in">Object</span>.assign(headers, &#123; <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span> &#125;),</span><br><span class="line">            timeout: <span class="number">10000</span>,</span><br><span class="line">            body: urlEncoded(data)</span><br><span class="line">        &#125;, <span class="string">'json'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>调用一次远程端口并查看日志输出。这里调用的也是案例中要使用到的获取banner的接口。这个接口不需要用户权限，后面还会遇到需要用户权限的接口。<br><img src="http://images.gitbook.cn/ff7983e0-1889-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<h2 id="自适应方法"><a href="#自适应方法" class="headerlink" title="自适应方法"></a>自适应方法</h2><p>这里推荐一种自适应的方法。同时也是前端在开发移动端页面的时候常用的方法。将手机屏幕宽度默认为750像素，然后将所有的宽高按照这个比例去缩放。这要求设计出的设计稿也要宽度是750。</p>
<p>在utils下新建一个<code>px.js</code>文件。按照出入的大小根据当前屏幕的宽度获取到缩放的比例并返回结果。<br><img src="http://images.gitbook.cn/ab16ed00-188a-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>在首页引入px方法，查看使用px之后的效果。<br><img src="http://images.gitbook.cn/d4992580-188a-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p><img src="http://images.gitbook.cn/d97950c0-188a-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>可以看到使用px将500像素缩放之后的效果和最开始设置的纯数字200效果是一致的。这里使用的是ios模拟器，真实的屏幕宽是375，按照750宽去算的话会把传入的参数统统除以2。</p>
<h2 id="封装本地存储"><a href="#封装本地存储" class="headerlink" title="封装本地存储"></a>封装本地存储</h2><p>RN提供的AsyncStorage可以根据key存储相应的字符串。我们这里改进一下，让它可以存储所有类型的字段。利用的是将传入的参数改造成对象，然后使用JSON的方法将对象转化成一个可以存储的字符串。</p>
<p>在utils下新建一个<code>Storage.js</code>。<br><img src="http://images.gitbook.cn/3ddb9950-188c-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>将传入的对象转化为字符串并存入AsyncStorage。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; AsyncStorage &#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取存储的数据</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; key </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">exports.getItem = <span class="keyword">async</span> (key) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> item = <span class="keyword">await</span> AsyncStorage.getItem(key);</span><br><span class="line">    <span class="keyword">if</span> (!item) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(item).v || <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 存入数据</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; key </span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; value </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">exports.setItem = <span class="function">(<span class="params">key, value</span>) =&gt;</span> AsyncStorage.setItem(key, <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">    v: value</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除已经存在的数据</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; key </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">exports.removeItem = <span class="function">(<span class="params">key</span>) =&gt;</span> AsyncStorage.removeItem(key);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 清除所有</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">exports.clear = <span class="function"><span class="params">()</span> =&gt;</span> AsyncStorage.clear();</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取所有的key</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">exports.getAllKeys = <span class="function"><span class="params">()</span> =&gt;</span> AsyncStorage.getAllKeys();</span><br></pre></td></tr></table></figure></p>
<p>在首页使用setItem存入数据,然后第二次进入页面再使用getItem获取数据。<br><img src="http://images.gitbook.cn/e9e272a0-188c-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>这里用到了componentDidMount这个方法。这个方法是在组件生命周期中的初始化完成之后执行的。<br><img src="http://images.gitbook.cn/11962cb0-188d-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<h2 id="添加弹出toast"><a href="#添加弹出toast" class="headerlink" title="添加弹出toast"></a>添加弹出toast</h2><p>之前公司使用的是自己开发的提示方法，这个方法需要改变原生代码，非常的不方便。这里推荐使用第三方的开源组件<code>react-native-root-toast</code>。只需要安装一下就好了。</p>
<p>执行命令，安装toast。<code>npm i --save react-native-root-toast</code>。</p>
<p>在utils目录下新建toast.js文件。添加toast的默认方法并填入默认参数。这里设置显示时间为1000毫秒，背景颜色是一个半透明的黑色。这里也是为了方便调用，如果需要多种效果的就定义多个吧。</p>
<p><img src="http://images.gitbook.cn/d5244750-18b2-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>在首页引入toast并看看实际的效果。<br><img src="http://images.gitbook.cn/41c80400-18b3-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<h2 id="让iOS支持http协议"><a href="#让iOS支持http协议" class="headerlink" title="让iOS支持http协议"></a>让iOS支持http协议</h2><p>苹果之前推荐使用https协议,现在默认是不支持http的。如果需要支持http需要单独设置。案例中的项目也用到了http，所以需要修改info.plist文件，让iOS可以访问http的地址。</p>
<p>使用xcode选择打开其他项目。<br><img src="http://images.gitbook.cn/0da257a0-1919-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>打开项目下的iOS文件夹，选择项目文件并打开。<br><img src="http://images.gitbook.cn/4d6ce8a0-1919-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>选择info.plist文件，再右边选择第一行并点击+号添加一项。<br><img src="http://images.gitbook.cn/8aa0f040-1919-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>选择App Transport Security Setting这一项，会弹出提示。点击确定即可自动刷新。<br><img src="http://images.gitbook.cn/01e614a0-191a-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>在上面添加的新配置中添加一个新的配置Allow Arbitrary Loads，同时设置为YES。<br><img src="http://images.gitbook.cn/678825a0-191a-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>改完配置还需要编译一次。点击左上角的三角形或者菜单中product下的build选项。<br><img src="http://images.gitbook.cn/b2b5aeb0-191c-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>这里我使用的是xcode修改配置文件，如果你发现配置文件没有变化，也可以自己改info.plist文件的内容。</p>
<h2 id="编译安卓客户端"><a href="#编译安卓客户端" class="headerlink" title="编译安卓客户端"></a>编译安卓客户端</h2><p>使用android studio打开根项目下的android目录。打开build.gradle文件。这个就是项目的gradle配置文件，通常使用这个文件对整个项目进行描述。<br><img src="http://images.gitbook.cn/3d6d4f10-204b-11e8-94c8-43a1e6ab60e0" alt="enter image description here"></p>
<p>经过一定时间的等待，IDE就会初始化整个项目。如果有一些需要下载的文件也会在这个时间通知下载。</p>
<p>点击菜单<code>build/gennerate signed apk</code>。这个就是编译一个可以安装在安卓手机上的安装包。也可以通过点击<code>make project</code>来看看项目是否可以编译通过。<br><img src="http://images.gitbook.cn/b5fcf4d0-204b-11e8-a1dd-77d9e3f43337" alt="enter image description here"></p>
<p>点击next，IDE会提示需要选择一个证书。这里可以选择一个已有的并输入密码，也可以通过点击<code>create new</code>来创建一个。后面一直点击next就可以了，IDE会在生成apk之后弹出通知。<br><img src="http://images.gitbook.cn/021b3160-204c-11e8-8063-17489f4fcf26" alt="enter image description here"></p>
<p>选择创建一个新的证书。根据提示填入相应的内容，之后点击ok即可生成。记得选择remember password，下次直接填入密码。<br><img src="http://images.gitbook.cn/8d33ddb0-204c-11e8-a1dd-77d9e3f43337" alt="enter image description here"></p>
<p>经过一整机器躁动之后，IDE弹出编译结果。点击蓝色字可以快速打开apk的地址。<br><img src="http://images.gitbook.cn/daecb770-204c-11e8-8d07-7f10cb77068c" alt="enter image description here"></p>
<p>将apk文件发送到手机上安装即可。一个你自己开发的app就安装好了。<br><img src="http://images.gitbook.cn/14e47fd0-204d-11e8-94c8-43a1e6ab60e0" alt="enter image description here"></p>
<p>这里要注意，在打包之前要把RN打包生成的bundle文件放入android文件下的assets目录中。否则安卓会因为找不到启动文件而报错。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.guofangchao.com/2018/03/14/01-基础-项目初始化/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="疯狂紫萧">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IT技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/14/01-基础-项目初始化/" itemprop="url">01.基础-项目初始化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-14T22:12:00+08:00">
                2018-03-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/big-front-end/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/03/14/01-基础-项目初始化/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2018/03/14/01-基础-项目初始化/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>知识点：<br>1.快速创建RN项目<br>2.添加使用路由功能<br>3.不要在RN中使用的功能</p>
</blockquote>
<p>从这里开始，我们将一步一步的创建一个可以真正的使用的app。第一部分讲述开发一个app的大致过程，第二部分将开始优化性能、开发效率等，第三部分教大家添加热更新、支付、分享这些功能。大多数第三方组件可以很方便的link到项目里，部分需要手动导入甚至主动开发一些东西，这里也会在用到的时候讲出来。</p>
<h2 id="创建项目的前提条件·"><a href="#创建项目的前提条件·" class="headerlink" title="创建项目的前提条件·"></a>创建项目的前提条件·</h2><p>使用react-native创建一个新的项目请确保你的电脑上已经满足下面的这些条件。</p>
<ul>
<li>nodejs。RN的所有库都是从npm上安装的。请确保你的电脑上已经安装了npm。可以使用<code>npm -v</code>来查看当前是否安装了npm。当前项目使用的node版本是8.9.3，npm的版本是5.5.3。</li>
<li>react-native-cli。这个通常用作RN的初始化和启动模拟器等，是用npm可以安装到电脑上。</li>
<li>python。RN里面有些脚本是使用python写的。请确保电脑上已经安装了python2.7以上的版本。</li>
<li>jdk1.8。安卓项目需要使用jdk1.8，请在电脑上安装好jdk1.8。安装的教程可以方便从网上搜索到。</li>
<li>Android Studio。调试以及编译安卓代码需要使用到。请在安装Android Studio之后安装好Android SDK以及模拟器。模拟器可以使用市面上的安卓模拟器，它们普遍比自带的模拟器要快。闲麻烦的同学可以直接连接手机调试。在安装好IED之后请下载好需要使用到的androidSDK。下载SDK需要科学上网或者把下载地址替换成国内的几个下载源。</li>
<li>git。后面的项目会加入到git中，使用git做版本管理的好处不言而喻。</li>
<li>Xcode（仅ios项目中）。安装了Xcode才能使用iOS模拟器。ios模拟器下的开发速度要明显优于安卓下，后面的开发过程大多数也是在ios模拟器中进行的。在模拟器中的表现都差不多，有些不一样的效果可以在看到的时候单独调试。</li>
<li>Watchman（仅mac系统用到）。Watchman用来监听文件变动等。mac下必须安装Watchman。</li>
<li>vscode。文中演示项目使用的编辑器是vscode。这里也推荐使用vscode开发前端项目。</li>
</ul>
<h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><p>我们先在本地创建一个可运行的项目，同时这个项目会加入到git的版本管理中。</p>
<ol>
<li><p>执行<code>react-native init anxintao --version 0.53.0</code>。<br><img src="http://images.gitbook.cn/071f3b30-17ef-11e8-bb03-7fdf01f131d9" alt="enter image description here"><br>图中<code>1</code>代表之前安装的react-native-cli的命令。<br>图中<code>2</code>代表初始化命令。<br>图中<code>3</code>代表项目的名称，这里是<code>anxintao</code>。<br>图中<code>4</code>代表指定RN的版本号，这个参数不传默认使用最新版。<br>图中<code>5</code>代表RN具体使用的版本号。</p>
</li>
<li><p>使用vscode打开项目，在项目根目录下执行命令启动初始化之后的项目，mac下推荐<code>react-native run-ios</code>，window下推荐<code>react-native run-android</code>启动默认的项目。如果能启动说明项目初始化完成，否则说明项目的某些东西没有安装好。<br><img src="http://images.gitbook.cn/9ddb0af0-17f3-11e8-8ff9-0914ae84128c" alt="enter image description here"><br>这里推荐把启动的命令写入到package.json文件中。比如:输入<code>npm run ios</code>即可代替原来的<code>react-native run-ios</code>，输入命令的速度快了不少。也可以给vscode安装一个启动RN的插件，不过效果跟输命令差不多，具体要看个人习惯了。</p>
</li>
<li><p>到这里就说明项目创建成功了。这个项目现在还很简单，它的原生部分只有一个简单的空壳。这个空壳仅仅是初始化了一个RN的activity，所有的js都是运行在根视图上的。</p>
</li>
<li>这里注意一下，新建的项目提示了按键可以刷新页面或者调出菜单。这显示的是ios模拟器，按键为<code>command R</code>刷新和<code>command D</code>调出菜单。</li>
</ol>
<h2 id="添加路由"><a href="#添加路由" class="headerlink" title="添加路由"></a>添加路由</h2><p>一个完整的项目不能没有路由。这里我们使用<a href="https://reactnavigation.org/" target="_blank" rel="noopener">React Navigation</a>。</p>
<p>在写文章的时候已经有一个路由组件<code>react-native-navigation</code>热度超过了react-navigation。它更多的使用的是原生的路由切换，效果更好。想用的同学可以去尝试一下。</p>
<ol>
<li>安装路由。在根目录下执行<code>npm install --save react-navigation</code>。</li>
<li>在根目录下新建<code>src</code>目录。所有页面放入这个文件夹下。</li>
<li><p>新建一个首页，给后面的路由调用。页面路径为:<code>根目录/src/home/index.js</code></p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    StyleSheet,</span><br><span class="line">    View,</span><br><span class="line">    Text</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> &lt;View style=&#123;&#123; marginTop: 200 &#125;&#125;&gt;</span><br><span class="line">            &lt;Text&gt;这是首页&lt;/Text&gt;</span><br><span class="line">        &lt;/View&gt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改根目录下的<code>index.js</code>。添加整个项目的路由。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; AppRegistry &#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</span><br><span class="line"><span class="keyword">import</span> Pages <span class="keyword">from</span> <span class="string">'./src'</span>;</span><br><span class="line"><span class="comment">//启动</span></span><br><span class="line">AppRegistry.registerComponent(<span class="string">'anxintao'</span>, () =&gt; Pages);</span><br></pre></td></tr></table></figure>
<p>5.在src目录下新建<code>index.js</code>文件。在这个文件里添加路由。我们从简单的一个页面开始。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    StyleSheet</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</span><br><span class="line"><span class="comment">//添加路由组件</span></span><br><span class="line"><span class="keyword">import</span> Navigation <span class="keyword">from</span> <span class="string">'react-navigation'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//添加展示用的首页</span></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">'./home/index'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建路由</span></span><br><span class="line"><span class="keyword">const</span> Pages = Navigation.StackNavigator(&#123;</span><br><span class="line">    <span class="string">'Home'</span>: &#123;</span><br><span class="line">        screen: Home</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="comment">//这里做了一个页面跳转的动画</span></span><br><span class="line">    transitionConfig: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">        screenInterpolator: <span class="function"><span class="params">sceneProps</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; layout, position, scene &#125; = sceneProps;</span><br><span class="line">            <span class="keyword">const</span> &#123; index &#125; = scene;</span><br><span class="line">            <span class="comment">//设置页面跳转的动画</span></span><br><span class="line">            <span class="keyword">const</span> translateX = position.interpolate(&#123;</span><br><span class="line">                inputRange: [index - <span class="number">1</span>, index, index + <span class="number">1</span>],</span><br><span class="line">                outputRange: [layout.initWidth, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">const</span> opacity = position.interpolate(&#123;</span><br><span class="line">                inputRange: [index - <span class="number">1</span>, index - <span class="number">0.99</span>, index, index + <span class="number">0.99</span>, index + <span class="number">1</span>],</span><br><span class="line">                outputRange: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0.3</span>, <span class="number">0</span>]</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> &#123; opacity, <span class="attr">transform</span>: [&#123; translateX &#125;] &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;),</span><br><span class="line">    navigationOptions: &#123;</span><br><span class="line">        header: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个自己的容器,方便以后对路由做一些处理</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> &lt;Pages onNavigationStateChange=&#123;this.listenChange.bind(this)&#125;&gt;&lt;/Pages&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//监听路由的跳转</span></span><br><span class="line">    listenChange(state1, state2, action) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>6.添加完成之后删除掉初始化项目之后的App.js。这个时候在模拟器中使用快捷键<code>command+R</code>即可刷新刷新页面。<br><img src="http://images.gitbook.cn/479e89e0-1876-11e8-8087-9b6b3b447adf" alt="enter image description here"><br>7.至此就完成了简单的路由设置。之后只需要添加页面并在路由中注册即可使用。</p>
<h2 id="路由升级版"><a href="#路由升级版" class="headerlink" title="路由升级版"></a>路由升级版</h2><p>简单的路由并不能起到很好的作用，我们还是创建一个更实用的路由吧。比如带3个tab切换的首页，这也是大多数app使用套路。</p>
<ol>
<li>添加4个tab切换页。我们假定未来需要4个切换页，分别是首页、分类页、购物车、个人中心。在home下分别创建他们。<br><img src="http://images.gitbook.cn/084841b0-187a-11e8-8087-9b6b3b447adf" alt="enter image description here"></li>
<li>修改路由所在的index文件。引入下面要用到的几个组件和页面</li>
</ol>
<p>添加新加入的页面<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    StyleSheet,</span><br><span class="line">    Image</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</span><br><span class="line"><span class="comment">//添加路由组件</span></span><br><span class="line"><span class="keyword">import</span> Navigation <span class="keyword">from</span> <span class="string">'react-navigation'</span>;</span><br><span class="line"><span class="comment">//添加展示用的首页</span></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">'./home/index'</span></span><br><span class="line"><span class="keyword">import</span> Products <span class="keyword">from</span> <span class="string">'./home/products'</span></span><br><span class="line"><span class="keyword">import</span> Shop_Cart <span class="keyword">from</span> <span class="string">'./home/shop_cart'</span></span><br><span class="line"><span class="keyword">import</span> My <span class="keyword">from</span> <span class="string">'./home/my'</span></span><br></pre></td></tr></table></figure></p>
<p>创建底部的样式<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建tab页的顶部样式</span></span><br><span class="line"><span class="keyword">const</span> styles = StyleSheet.create(&#123;</span><br><span class="line">    tab: &#123;</span><br><span class="line">        height: <span class="number">40</span>,</span><br><span class="line">        backgroundColor: <span class="string">'#fbfafc'</span>,</span><br><span class="line">        borderTopColor: <span class="string">'#efefef'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    tabIcon: &#123;</span><br><span class="line">        width: <span class="number">20</span>,</span><br><span class="line">        height: <span class="number">20</span></span><br><span class="line">    &#125;,</span><br><span class="line">    tabLabel: &#123;</span><br><span class="line">        marginBottom: <span class="number">4</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>创建一个tab路由，为了简单这里只展示2个页面的。具体的代码可以去git仓库查看。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//创建首页的tab页</span></span><br><span class="line"><span class="keyword">const</span> Tabs = Navigation.TabNavigator(&#123;</span><br><span class="line">    <span class="string">'Home'</span>: &#123;</span><br><span class="line">        screen: Home,</span><br><span class="line">        navigationOptions: <span class="function">(<span class="params">&#123; navigation, screenProps &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                tabBarLabel: <span class="string">'首页'</span>,</span><br><span class="line">                tabBarIcon: <span class="function">(<span class="params">opt</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (opt.focused) <span class="keyword">return</span> &lt;Image source=&#123;&#123; uri: require('./images/tab-home-active') &#125;&#125; style=&#123;styles.tabIcon&#125;&gt;&lt;/Image&gt;;</span><br><span class="line">                    <span class="keyword">return</span> &lt;Image source=&#123;&#123; uri: require('./images/tab-home') &#125;&#125; style=&#123;styles.tabIcon&#125;&gt;&lt;/Image&gt;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'Products'</span>: &#123;</span><br><span class="line">        screen: Products,</span><br><span class="line">        navigationOptions: <span class="function">(<span class="params">&#123; navigation, screenProps &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                tabBarLabel: <span class="string">'产品分类'</span>,</span><br><span class="line">                tabBarIcon: <span class="function">(<span class="params">opt</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (opt.focused) <span class="keyword">return</span> &lt;Image source=&#123;&#123; uri: require('./images/tab-products-active') &#125;&#125; style=&#123;styles.tabIcon&#125;&gt;&lt;/Image&gt;;</span><br><span class="line">                    <span class="keyword">return</span> &lt;Image source=&#123;&#123; uri: require('./images/tab-products') &#125;&#125; style=&#123;styles.tabIcon&#125;&gt;&lt;/Image&gt;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;, &#123;</span><br><span class="line">	<span class="comment">//设置tab使用的组件</span></span><br><span class="line">    tabBarComponent: Navigation.TabBarBottom,</span><br><span class="line">    <span class="comment">//点击哪个才加载哪个tab里的页面</span></span><br><span class="line">    lazy: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">//设置tab放在界面的底部</span></span><br><span class="line">    tabBarPosition: <span class="string">'bottom'</span>,</span><br><span class="line">    <span class="comment">//设置tab里面的样式</span></span><br><span class="line">    tabBarOptions: &#123;</span><br><span class="line">        style: styles.tab,</span><br><span class="line">        labelStyle: styles.tabLabel,</span><br><span class="line">        activeTintColor: <span class="string">'#d0648f'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>替换Pages里的第一个页面为刚才创建的Tab路由。由于默认加载第一个，所以需要将第一个设置成tab页。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'Tabs'</span>: &#123;</span><br><span class="line">        screen: Tabs</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p>3.现在再刷新模拟器,就会发现底部的Tab切换已经好了。点击可以切换不同的页面。<br><img src="http://images.gitbook.cn/da200e80-187e-11e8-8087-9b6b3b447adf" alt="enter image description here"></p>
<p>4.这里我将图片转化成base64的方式再引入到图片组件中。好处是打包之后会变成一个整体。坏处是打包之后的bundle文件会变大，做增量更新也比较麻烦。</p>
<h2 id="不推荐使用的东西"><a href="#不推荐使用的东西" class="headerlink" title="不推荐使用的东西"></a>不推荐使用的东西</h2><ol>
<li>投影。安卓不支持投影，在开发的时候如果没有必要就使用别的方式代替吧。比如使用图片代替投影。</li>
<li>边框色。在长列表中尽量不要使用边框色，在某些安卓手机下会闪退。</li>
<li>使用了圆角的情况再使用背景色。ios手机会出现边框颜色异常或者异常色块。去掉背景即可。</li>
<li>过于深层次的结构</li>
<li>过于频繁的刷新state</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.guofangchao.com/2018/03/14/00-为什么我选择react-native/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="疯狂紫萧">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IT技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/14/00-为什么我选择react-native/" itemprop="url">00.为什么我选择react-native</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-14T22:10:00+08:00">
                2018-03-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/big-front-end/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/03/14/00-为什么我选择react-native/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2018/03/14/00-为什么我选择react-native/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>在所有的技术选型之前都有一个为什么。</p>
</blockquote>
<p>为什么我选择了React-native？选择这个技术到底给我带来了什么样的技术福利？<br>如果你正在考虑RN，或者还在研究选择什么样的技术实现自家的APP。不妨看看我的课程，说不定你就有了不一样的感受。</p>
<p><strong>  注：react-native以下会简称RN。 </strong></p>
<h2 id="我注意的优点"><a href="#我注意的优点" class="headerlink" title="我注意的优点"></a>我注意的优点</h2><p>选择RN之前我也看过了其他的几种技术，早一点的时候我也使用过其他的技术做APP。比如HBuilder的框架，非常的方便、非常的好用、什么都不需要管。但是开发完之后发现性能很差，做一个稍微复杂点的项目就非常上火。后来切了原生，但是使用java做开发也有非常多得问题，开发效率很低。</p>
<p>后来我选择了RN，它使用js更新虚拟dom，通过一个桥接器将需要更新的结果通知到UI层，让native执行UI的改变。简单来说，就是用js做驱动开发一个类原生的APP。所有的渲染都是和原生一样的，一下子就讲原生开发和js开发连接起来。通过这么一个模式，将传统的java或者oc开发转变成了简单易懂的前端js开发。这是移动开发的一大进步，避免了一个APP多个平台多套代码的尴尬，同时提升了开发效率，将移动开发带入了一个新的层面。</p>
<p><img src="http://images.gitbook.cn/d52d8080-177d-11e8-9825-3dba87aeef7e" alt="enter image description here"></p>
<h3 id="性能相似"><a href="#性能相似" class="headerlink" title="性能相似"></a>性能相似</h3><p>很多人说RN的性能比不上原生的APP。这个说法是要看具体的场景下的。</p>
<p>在一般的应用场景下RN的表现和原生APP是没有太大的差别的。一个APP也不会是到处都是复杂的交互效果。一些简单的点缀动画再加上列表图片等才是一个APP最常见的内容。这种情况下它们之间的表现是一样的。</p>
<p>RN本身只是使用js处理了UI渲染之前的一些逻辑，在最终的渲染上其实使用的还是原生的逻辑。尤其是渲染完成之后更是和原生的没有半点区别。</p>
<p>我们的案例是一个电商项目，主要渲染逻辑是首页的自定义模板、无限加载的列表等。目前最大的性能瓶颈其实是在事件的优化上，优化之后用户已经感知不到和原生的区别了。我们会在后面的部分提到性能优化，将一个粗糙的app通过简单的方法提高10倍性能，再通过另外一个稍微复杂的方法减低内存占用。</p>
<h3 id="开发效率高"><a href="#开发效率高" class="headerlink" title="开发效率高"></a>开发效率高</h3><p>通常情况开发一款APP需要发布在安卓和iOS两个平台，导致的结果就是一个APP两个团队两套代码。界面几乎一样，为什么不能使用一套代码呢？之前也有大神使用各种手段达成这个目标，但是并不是很理想。</p>
<p>由于使用熟悉的react和jsx的模式，开发者只需要有前端知识就可以很迅速的上手一个RN项目。如果再学一些实战的例子，稍微复杂一些的项目也难不倒各位前端开发者。</p>
<p>debug超级方便，一边开发一边看效果再也不是梦。</p>
<h3 id="快速热更新"><a href="#快速热更新" class="headerlink" title="快速热更新"></a>快速热更新</h3><p>RN生成的js文件，只要不涉及原生功能的增减，已经发布的APP完全不需要重新安装即可完成新版功能的上线。用户只需打开APP就能体验到最新的APP，省去了下载重装的各种麻烦。把app的更新做到了和网页更新一样的方便快捷。</p>
<p>使用RN就能达到既有原生的所有能力，又有类似浏览器上的快速更新能力。同时还可以接入各种定制好的网页，将APP的自由度提高到一个非常高的地步。</p>
<h3 id="大公司背书"><a href="#大公司背书" class="headerlink" title="大公司背书"></a>大公司背书</h3><p>RN的开发者是facebook，背靠大树好乘凉，社区更疯狂。FB本身也在尝试使用RN技术开发自己的APP，RN一定会越来越完善。截止写这篇文章的时候RN已经更新到了0.53.0。</p>
<p>RN本身也是开源的，所有的源代码都是可以看到的。社区的讨论也是比较热烈的。现在可能中文文档还比较少，未来随着开发者的努力，这些坑都会填起来的。</p>
<hr>
<p>其实最开始的时候也没有想很多，仅仅是冲着RN可以快速开发，上线快体验好。经过了这么长时间的开发，我更加喜欢RN的这种开发方式，项目中也填了各种各样的坑。后面就用一个实际的例子来展示RN是怎样开发的吧。</p>
<h2 id="RN的缺点"><a href="#RN的缺点" class="headerlink" title="RN的缺点"></a>RN的缺点</h2><h3 id="升级快"><a href="#升级快" class="headerlink" title="升级快"></a>升级快</h3><p>RN本身其实还处于测试版，开发组经常会升级RN，解决一些遗留或者隐藏的bug。在这个的过程中就导致了RN本身升级非常快，开发者在使用RN开发APP的过程中应该尽量提高自己的版本，不需要一直是最新的，只要能够跟的上FB的节奏即可。</p>
<p>自己搞定的问题也是可以合并入RN的源代码里的。不要一味的等RN更新，有些问题自己解决更方便。建议会Android或者ios同学自己动手。</p>
<h3 id="动画难"><a href="#动画难" class="headerlink" title="动画难"></a>动画难</h3><p>这里的难指的是复杂的动画在开发中很难去优化。尤其是开发者懂前端但是不懂原生的情况下。好在常见的APP也不需要多么复杂的动画。一般使用位移变换就足够了，太复杂的动画建议使用RN的svg组件来做。</p>
<h3 id="webview难用"><a href="#webview难用" class="headerlink" title="webview难用"></a>webview难用</h3><p>RN自带的webview跟浏览器有一定的差别。APP经常要打开一些网页，可能在开发的时候一切正常，但是到了RN里面就会有一些奇怪的问题，主要还是受到系统浏览器的影响，会有一些兼容方面的问题。这种情况下不如微信使用自己研发的浏览器，可以畅快的使用ES6之类的新技术。</p>
<h3 id="需要原生支持"><a href="#需要原生支持" class="headerlink" title="需要原生支持"></a>需要原生支持</h3><p>简单的东西和界面的展现已经完全放手给了开发者。但是还是有一些功能只能原生去实现，如果原生部分的开发者对RN不太了解可能会给APP带来不可预知的bug。好在大多数开源看只需要执行link命令就可以把原生部分也安装好。</p>
<hr>
<p>技术都会有优点和缺点。选择合适的技术才能给项目带来长久的生命力。</p>
<h2 id="其他技术"><a href="#其他技术" class="headerlink" title="其他技术"></a>其他技术</h2><h3 id="weex"><a href="#weex" class="headerlink" title="weex"></a>weex</h3><p>核心思想上，这两家其实并没有什么区别。weex也可以算是站在RN的肩膀上起步的。目前活跃度不高，大多数是在观望中。</p>
<h4 id="开发框架"><a href="#开发框架" class="headerlink" title="开发框架"></a>开发框架</h4><p>weex使用vue。熟悉vue的开发者可能会更熟悉。</p>
<p>RN使用react。都是facebook出品，框架融合上会更方便一些。</p>
<p>它们都是组件化开发，都输数据绑定，都有虚拟dom。社区同样活跃，使用人数也都非常多。</p>
<h4 id="学习成本"><a href="#学习成本" class="headerlink" title="学习成本"></a>学习成本</h4><p>react的jsx初期会比较难上手，css的写法也跟前端的样式写法不一样。<br>weex使用模板的形式，直接html+css开发。上手会稍微简单一些。</p>
<h4 id="异步"><a href="#异步" class="headerlink" title="异步"></a>异步</h4><p>weex只支持callback的形式。<br>RN支持promise的形式。</p>
<p>这些都是可以解决的。不是什么问题。</p>
<h4 id="社区"><a href="#社区" class="headerlink" title="社区"></a>社区</h4><p>RN开源早，有facebook支持。社区的组件库已经比较丰富，社区活跃度比较高。<br>weex开源晚，社区活跃不高，以阿里系比较多。</p>
<h3 id="Flutter"><a href="#Flutter" class="headerlink" title="Flutter"></a>Flutter</h3><p>Flutter 是Google推出的一个跨平台（Android 和 iOS）移动开发框架，使用的是 Dart 语言。</p>
<p>Flutter 的目标是用来创建高性能、高稳定性、高帧率、低延迟的 Android 和 iOS 应用。并且开发出来的应用在不同的平台用起来跟原生应用具有一样的体验。不同的平台的原生体验应该得到保留，让该应用看起来同整个系统更加协调。不同平台的滚动操作、字体、图标 等特殊的特性 应该和该平台上的其他应用保持一致，让用户感觉就像操作原生应用一样。比如，返回图标 Android 和 iOS 是不一样的；滚动内容滚动到底的反馈也是不一样的。</p>
<h4 id="兼容"><a href="#兼容" class="headerlink" title="兼容"></a>兼容</h4><p>Flutter不使用系统提供的组件，自己实现了一套渲染机制，所以在性能优化、跨平台方面表现优秀。实际体验上，性能比RN要高不少。</p>
<p><img src="http://images.gitbook.cn/d1937460-177e-11e8-9825-3dba87aeef7e" alt="enter image description here"></p>
<p>RN最终调用的还是系统的组件，虽然FB已经很努力了，但是在某些时候还是会有兼容性需要处理。</p>
<h4 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h4><p>Flutter 内置了对Material Design的支持，给开发者提供了丰富的 UI 控件库选择。同时所有的组件都有扩展，保持了很高的灵活性。</p>
<p>RN通过react也做到了组件式开发，跟Flutter相比，多了一个桥接器的转换，性能上肯定不如Flutter。</p>
<h4 id="开发语言"><a href="#开发语言" class="headerlink" title="开发语言"></a>开发语言</h4><p>Flutter使用Dart实现。Dart号称要完全取代js，不过目前离这个目标还非常远。初期上手还是有一些难度的。</p>
<p>RN使用js开发，做过前端的都非常熟悉，上手很容易。</p>
<p><img src="http://images.gitbook.cn/97228460-177e-11e8-9825-3dba87aeef7e" alt="enter image description here"></p>
<hr>
<p>Flutter现在还在实验阶段，不排除google使用别的框架替换它的可能性。Dart语言也处于成长阶段，只有google的浏览器在支持。或许在Flutter持续发展到一个阶段之后，才会有很多支持者。</p>
<p>在写文章的时候google放出了第一个测试版，感兴趣的同学可以下载下来玩玩。</p>
<hr>
<p>相比于其他几种技术，RN是目前社区最活跃，开发效率最高的一种选择。选择RN也是需要在一个比较短的时间内能够完成APP的开发。尤其现在前端开发者可以非常容易的从网页开发转到APP开发上。对于我们包含APP、微信、小程序这样的三个平台更是需要RN这样的技术，一个团队就可以维护项目的持续增长。</p>
<p>如果你需要RN来开发自己的项目，那就看下去吧。我们将从简单的界面开发，数据更新等开始逐步深入。后面涉及到性能优化、自定义原生部分等。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="疯狂紫萧" />
            
              <p class="site-author-name" itemprop="name">疯狂紫萧</p>
              <p class="site-description motion-element" itemprop="description">疯狂紫萧,郭方超</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/cuo9958" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:545570335@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">疯狂紫萧</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  









  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three-waves.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'JVfh8Anp0UMvaxLASDflkRGG-gzGzoHsz',
        appKey: 'mMoiWejqJwBDcku0FIuKXMYy',
        placeholder: 'Just go go',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  

  

  
  

  

  

  

</body>
</html>
